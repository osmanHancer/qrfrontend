<div class="companies-container">
  <!-- Header -->
  <div class="header">
    <h1>Åirket YÃ¶netimi</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="showAddCompanyForm()">
        <i class="icon">+</i> Yeni Åirket Ekle
      </button>
      <button class="btn btn-secondary" (click)="logout()">
        <i class="icon">ğŸšª</i> Ã‡Ä±kÄ±ÅŸ Yap
      </button>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-container">
    <input type="text" [(ngModel)]="searchTerm" (input)="searchCompanies()"
      placeholder="Åirket ismi veya ÅŸirket kodu ile ara..." class="search-input">
  </div>

  <!-- Add Company Form -->
  @if (showAddForm) {
  <div class="form-container">
    <div class="form-card">
      <h2>Yeni Åirket Ekle</h2>
      <form (ngSubmit)="addCompany()">
        <div class="form-group">
          <label for="sirketIsmi">Åirket Ä°smi *</label>
          <input type="text" id="sirketIsmi" [(ngModel)]="newCompany.sirketIsmi" name="sirketIsmi" required class="form-input">
        </div>

        <div class="form-group">
          <label for="media">FotoÄŸraflar ve Videolar</label>
          <input type="file" id="media" (change)="onMediaSelected($event)" multiple accept="image/*,video/*"
            class="form-input">
        </div>

        <div class="form-group">
          <label for="konum">Konum (Enlem, Boylam)</label>
          <input type="text" id="konum" [(ngModel)]="newCompany.konum" name="konum" 
            placeholder="Ã–rn: 41.0082, 28.9784 veya Ä°ÅŸ Merkezi Adresi" class="form-input">
          <small class="form-help-text">Enlem ve boylam koordinatlarÄ± (Ã¶rn: 41.0082, 28.9784) veya adres bilgisi girebilirsiniz.</small>
        </div>

        <div class="form-group">
          <label for="website">Website Adresi</label>
          <input type="url" id="website" [(ngModel)]="newCompany.website" name="website" 
            placeholder="Ã–rn: https://www.example.com" class="form-input">
          <small class="form-help-text">Åirket web sitesi adresini giriniz (Ã¶rn: https://www.example.com)</small>
        </div>

        <div class="form-group">
          <label for="sirketTanitimi">Åirket TanÄ±tÄ±mÄ±</label>
          <quill-editor [(ngModel)]="newCompany.sirketTanitimi" name="sirketTanitimi" [styles]="{height: '200px'}" format="html">
          </quill-editor>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Åirket Ekle</button>
          <button type="button" class="btn btn-secondary" (click)="cancelForm()">Ä°ptal</button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Edit Company Form -->
  @if (showEditForm) {
  <div class="form-container">
    <div class="form-card">
      <h2>Åirket DÃ¼zenle</h2>
      <form (ngSubmit)="updateCompany()">
        <div class="form-group">
          <label for="edit-sirketIsmi">Åirket Ä°smi *</label>
          <input type="text" id="edit-sirketIsmi" [(ngModel)]="editCompany.sirketIsmi" name="edit-sirketIsmi" required class="form-input">
        </div>

        <div class="form-group">
          <label for="edit-media">Yeni FotoÄŸraflar ve Videolar Ekle</label>
          <input type="file" id="edit-media" (change)="onMediaSelected($event)" multiple accept="image/*,video/*"
            class="form-input">
        </div>

        <div class="form-group">
          <label for="edit-konum">Konum (Enlem, Boylam)</label>
          <input type="text" id="edit-konum" [(ngModel)]="editCompany.konum" name="edit-konum" 
            placeholder="Ã–rn: 41.0082, 28.9784 veya Ä°ÅŸ Merkezi Adresi" class="form-input">
          <small class="form-help-text">Enlem ve boylam koordinatlarÄ± (Ã¶rn: 41.0082, 28.9784) veya adres bilgisi girebilirsiniz.</small>
        </div>

        <div class="form-group">
          <label for="edit-website">Website Adresi</label>
          <input type="url" id="edit-website" [(ngModel)]="editCompany.website" name="edit-website" 
            placeholder="Ã–rn: https://www.example.com" class="form-input">
          <small class="form-help-text">Åirket web sitesi adresini giriniz (Ã¶rn: https://www.example.com)</small>
        </div>

        <div class="form-group">
          <label for="edit-sirketTanitimi">Åirket TanÄ±tÄ±mÄ±</label>
          <quill-editor #editQuillEditor [(ngModel)]="editCompany.sirketTanitimi" name="edit-sirketTanitimi" [styles]="{height: '200px'}"
            format="html" (onEditorCreated)="onEditEditorCreated($event)">
          </quill-editor>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">GÃ¼ncelle</button>
          <button type="button" class="btn btn-secondary" (click)="cancelForm()">Ä°ptal</button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Companies List -->
  <div class="companies-list">
    <div class="list-header">
      <h3>Åirketler ({{filteredCompanies.length}})</h3>
    </div>

    @if (filteredCompanies.length > 0) {
    <div class="companies-grid">
      <div class="company-card" *ngFor="let company of filteredCompanies">
        <div class="company-header">
          <h4>{{company.sirketIsmi}}</h4>
          <div class="company-actions">
            <button class="btn btn-sm btn-primary" (click)="showEditCompanyForm(company)">
              <i class="icon">âœï¸</i>
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteCompany(company)">
              <i class="icon">ğŸ—‘ï¸</i>
            </button>
          </div>
        </div>

        <div class="company-info">
          <p><strong>Åirket Kodu:</strong> {{company.companyCode}}</p>
          @if (company.konum) {
          <p><strong>Konum:</strong> {{company.konum}}</p>
          }
          @if (company.website) {
          <p><strong>Website:</strong> <a [href]="company.website" target="_blank" class="website-link">{{company.website}} <i class="icon">ğŸ”—</i></a></p>
          }
        </div>

        <!-- Media Section (sadece dÃ¼zenleme modunda ve seÃ§ili ÅŸirket iÃ§in) -->
        @if (showEditForm && selectedCompany?.companyCode === company.companyCode) {
        <div class="company-media">
          <h5>FotoÄŸraflar ve Videolar ({{companyMedia[company.companyCode]?.length || 0}}):</h5>

          <div class="media-upload">
            <input type="file" [id]="'media-upload-' + company.id"
              (change)="onMediaSelectedForCompany($event, company.companyCode)" multiple accept="image/*,video/*"
              class="media-upload-input">
            <label [for]="'media-upload-' + company.id" class="media-upload-label">
              <i class="icon">ğŸ“·</i> FotoÄŸraf/Video Ekle
            </label>
          </div>

          @if (companyMedia[company.companyCode] && companyMedia[company.companyCode].length > 0) {
          <div class="media-grid">
            <div class="media-item" *ngFor="let media of companyMedia[company.companyCode]; let i = index">
              <img *ngIf="!isVideoFile(media)" [src]="getMediaUrl(company.companyCode, media)" [alt]="company.sirketIsmi" class="company-image"
                (error)="onMediaError($event, media, company.companyCode)" (load)="onMediaLoad($event, media, company.companyCode)">
              <video *ngIf="isVideoFile(media)" [src]="getMediaUrl(company.companyCode, media)" class="company-video" preload="metadata" controls>
                <source [src]="getMediaUrl(company.companyCode, media)" type="video/mp4">
                TarayÄ±cÄ±nÄ±z video oynatmayÄ± desteklemiyor.
              </video>
              <div class="media-info">
                <small>{{media}}</small>
              </div>
              <button class="btn btn-sm btn-danger remove-media" (click)="removeMedia(company.companyCode, media)">
                <i class="icon">âŒ</i>
              </button>
            </div>
          </div>
          } @else {
          <div class="no-media">
            <p>HenÃ¼z fotoÄŸraf veya video eklenmemiÅŸ</p>
          </div>
          }
        </div>
        }

        <!-- QR Code Section -->
        <div class="company-qr">
          <h5>QR Kod:</h5>
          <div class="qr-container">
            @if (company.qrKod) {
            <img [src]="getQRCodeUrl(company.companyCode)" [alt]="'QR Kod - ' + company.sirketIsmi"
              class="qr-image">
            <button class="btn btn-sm btn-primary" (click)="downloadQRCode(company.companyCode, company.sirketIsmi)">
              <i class="icon">â¬‡ï¸</i> Ä°ndir
            </button>
            } @else {
            <div class="no-qr">
              <p>QR kod oluÅŸturulmamÄ±ÅŸ</p>
              <button class="btn btn-sm btn-success" (click)="generateQRCode(company.companyCode)">
                <i class="icon">ğŸ”—</i> QR Kod OluÅŸtur
              </button>
            </div>
            }
          </div>
        </div>
      </div>
    </div>
    } @else {
    <div class="no-companies">
      <p>HenÃ¼z ÅŸirket eklenmemiÅŸ.</p>
      <button class="btn btn-primary" (click)="showAddCompanyForm()">Ä°lk Åirketi Ekle</button>
    </div>
    }
  </div>
</div>

